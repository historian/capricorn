#!/usr/bin/env ruby

require 'capricorn'

def convert_app(app)
  application = {}
  application[:id]          = app[1]
  application[:node]        = app[2]
  application[:name]        = app[3]
  application[:domain]      = app[4].shift
  application[:aliases]     = app[4]
  application[:environment] = app[5]
  application
end

Erlang do |cmd|
  case cmd.shift
  when :create
    recipe = cmd.shift
    app = convert_app(cmd.first)

    recipe_path = File.expand_path("../../lib/capricorn/recipes/#{recipe}.rb", __FILE__)
    ctx = Capricorn::SystemContext.run(recipe_path, :application => app)

    send t[true, t[ctx.www_user, ctx.www_group, ctx.root_path]]
  end
end
